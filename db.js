const sqlite=require('sqlite3')
const db =new sqlite.Database('CargoEase.db')

//user table
const createUserTable = `CREATE TABLE IF NOT EXISTS USER(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    NAME TEXT NOT NULL,
    EMAIL TEXT UNIQUE NOT NULL,
    PASSWORDHASH TEXT NOT NULL,
    ROLE TEXT CHECK (ROLE IN('USER','ADMIN')) NOT NULL,
    CREATEDAT TEXT DEFAULT CURRENT_TIMESTAMP
    );`


const createShipmentTable = `CREATE TABLE IF NOT EXISTS SHIPMENT(
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    TRACKINGNUMBER TEXT UNIQUE NOT NULL,
    SENDERID INTEGER NOT NULL,
    RECEIVERID INTEGER NOT NULL,
    ORIGINCOUNTRY TEXT NOT NULL,
    DESTINATIONCOUNTRY TEXT NOT NULL,
    WEIGHT REAL,
    SIZE TEXT CHECK (SIZE IN ('SMALL','MEDIUM','LARGE')) NOT NULL,
    DELIVERYTYPE TEXT CHECK(DELIVERYTYPE IN ('STANDARD','EXPRESS')) NOT NULL DEFAULT 'STANDARD',
    STATUS TEXT NOT NULL,
    CREATEDAT TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (SENDERID) REFERENCES USER(ID),
    FOREIGN KEY (RECEIVERID) REFERENCES USER(ID)
    );`



    
//history status table
const createStatusHistoryTable = `CREATE TABLE IF NOT EXISTS STATUSHISTORY (
    ID INTEGER PRIMARY KEY AUTOINCREMENT,
    SHIPMENTID INTEGER NOT NULL,
    STATUS TEXT NOT NULL,
    MESSAGE TEXT NOT NULL,
    TIMESTAMP TEXT DEFAULT CURRENT_TIMESTAMP,
    FOREIGN KEY (SHIPMENTID) REFERENCES SHIPMENT(ID)
    );`



module.exports = {
    db,
    createUserTable,
    createShipmentTable,
    createStatusHistoryTable
};
